name: "Wails Build for pz-admin"
description: "Builds the pz-admin application for all platforms including ARM64"

on:
  push:
    branches:
      - actions-test

runs:
  using: "composite"
  steps:
    # Setup GoLang
    - name: Setup GoLang
      uses: actions/setup-go@v4
      with:
        go-version: "1.23.4"
    - run: go version
      shell: bash

    # Setup NodeJS
    - name: Setup NodeJS
      uses: actions/setup-node@v3
      with:
        node-version: "22.11.0"
    - run: node --version
      shell: bash

    # Install Wails
    - name: Install Wails
      run: go install github.com/wailsapp/wails/v2/cmd/wails@v2.9.2
      shell: bash

    # Install platform-specific dependencies
    - name: Install Linux Dependencies
      if: runner.os == 'Linux'
      run: sudo apt-get update && sudo apt-get install -y libgtk-3-0 libwebkit2gtk-4.0-dev gcc-aarch64-linux-gnu
      shell: bash

    - name: Install macOS Dependencies
      if: runner.os == 'macOS'
      run: brew install mitchellh/gon/gon
      shell: bash

    # Build for macOS
    - name: Build for macOS
      if: runner.os == 'macOS'
      run: wails build --platform darwin/universal -webview2 download -o pz-admin-macos
      shell: bash

    # Build for Linux AMD64
    - name: Build for Linux AMD64
      if: runner.os == 'Linux'
      run: wails build --platform linux/amd64 -webview2 download -o pz-admin-linux-amd64
      shell: bash

    # Build for Linux ARM64
    - name: Build for Linux ARM64
      if: runner.os == 'Linux'
      run: wails build --platform linux/arm64 -webview2 download -o pz-admin-linux-arm64
      shell: bash

    # Build for Windows AMD64 with NSIS
    - name: Build for Windows AMD64
      if: runner.os == 'Windows'
      run: wails build --platform windows/amd64 -webview2 download -nsis -o pz-admin-windows-amd64.exe
      shell: bash

    # Build for Windows ARM64 with NSIS
    - name: Build for Windows ARM64
      if: runner.os == 'Windows'
      run: wails build --platform windows/arm64 -webview2 download -nsis -o pz-admin-windows-arm64.exe
      shell: bash

    # Adjust permissions for macOS and Linux
    - name: Adjust Permissions (Linux)
      if: runner.os == 'Linux'
      run: chmod +x pz-admin-linux-*
      shell: bash

    - name: Adjust Permissions (macOS)
      if: runner.os == 'macOS'
      run: chmod +x pz-admin-macos
      shell: bash

    # Upload build artifacts
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pz-admin-Build
        path: |
          pz-admin-macos
          pz-admin-linux-*
          pz-admin-windows-*.exe
